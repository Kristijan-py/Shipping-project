<!DOCTYPE html>
<html>
<head>
    <title>View Orders</title>
</head>
<body>
    <h1>All Orders</h1>
    <div style="display: flex; margin-left: 400px">
        <button><a href="/dashboard">Dashboard</a></button>
    </div>
    <% if (error) { %>
        <p style="color: red;"><%= error %></p>
    <% } else if (orders.length === 0) { %>
        <p>No orders found.</p>
    <% } else { %>
        <ul>
            <% orders.forEach(order => { %>
                <li>
                    <strong>Order id:</strong> <%= order.id %><br>
                    <strong>Sender Name:</strong> <%= order.sender_name %><br>
                    <strong>Sender Phone:</strong> <%= order.sender_phone %><br>
                    <strong>Buyer Name:</strong> <%= order.buyer_name %><br>
                    <strong>Buyer Phone:</strong> <%= order.buyer_phone %><br>
                    <strong>Buyer City:</strong> <%= order.buyer_city %><br>
                    <strong>Buyer Village:</strong> <%= order.buyer_village %><br>
                    <strong>Buyer Adress:</strong> <%= order.buyer_adress %><br>
                    <strong>Price:</strong> <%= order.price %><br>
                    <strong>Package Type:</strong> <%= order.package_type %><br>
                    <strong>Shipping Fee:</strong> <%= order.shipping_fee %><br>
                    <strong>Who's Paying:</strong> <%= order.whos_paying %><br>
                    <form action="/api/orders/<%= order.id %>?_method=DELETE" method="POST" style="margin-top: 3px;">
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="submit">Delete</button>
                    </form>
                </li>
                <br>
                <br>
            <% }) %>
        </ul>
        <!-- Pagination -->
        <% 
            const totalPaginationSize = 5;
            const currentPaginationSize = Math.floor((pagination.currentPage - 1) / totalPaginationSize);
            const startPage = currentPaginationSize * totalPaginationSize + 1;
            let endPage = startPage + totalPaginationSize - 1;
            if(endPage > pagination.totalPages) {
                endPage = pagination.totalPages;
            }
        %>
        <footer style="position: fixed; width: 100%; bottom: 0;">
            <div style="display: flex; justify-content: center; margin-bottom: 30px;">
            <% if (pagination && pagination.totalPages > 1) { %> 
                <div style="display: flex; gap: 20px; align-items: center;">
                    <!-- First and Prev -->
                     <% if(pagination.currentPage > 1) { %>
                        <a href="/orders?page=<%= 1 %>&limit=<%= pagination.pageLimit %>">
                            <button>First</button>
                        </a>
    
                        <a href="/orders?page=<%= pagination.currentPage - 1 %>&limit=<%= pagination.pageLimit %>">
                            <button>Prev</button>
                        </a>
                    <% } else { %>
                        <button disabled>Prev</button>
                        <button disabled>First</button>
                    <% } %>

                    <!-- Pagination numbers -->
                    <% for (let i= startPage; i <= endPage; i++) { %>
                        <a href="/orders?page=<%= i %>&limit=<%= pagination.pageLimit %>">
                            <!-- Bold the number and put background if we are on that current page-->
                            <button style="<%= pagination.currentPage === i ? 'font-weight: bold; background-color: lightgray;' : '' %>">
                                <%= i %>
                            </button>
                        </a>
                    <% } %>

                    <!-- Last and Next -->
                     <% if(pagination.currentPage < pagination.totalPages) { %>
                        <a href="/orders?page=<%= pagination.currentPage + 1 %>&limit=<%= pagination.pageLimit %>">
                            <button>Next</button>
                        </a>
    
                        <a href="/orders?page=<%= pagination.totalPages %>&limit=<%= pagination.pageLimit %>">
                            <button>Last</button>
                        </a>
                    <% } else { %>
                        <button disabled>Next</button>
                        <button disabled>Last</button>
                    <% } %>

                </div>
            <% } %>
            </div>
        </footer>
        

    <% } %>
</body>
</html>
